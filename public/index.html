<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Image Generator</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Arial; margin: 24px; }
    .wrap { max-width: 760px; margin: 0 auto; }
    .row { display:flex; gap:12px; align-items: center; flex-wrap: wrap; }
    textarea { width:100%; min-height:100px; padding:12px; }
    select, input, button { padding:10px 12px; }
    button { background:#10a37f; color:white; border:0; border-radius:6px; font-weight:600; }
    button:disabled { opacity:.6; }
    .preview { margin-top:16px; border:1px solid #ddd; padding:12px; border-radius:8px; }
    img { max-width:100%; height:auto; display:block; }
    .note { color:#666; font-size:.95rem; }
    .row label { font-size:.9rem; color:#444; }
    .env { background:#f7f7f7; padding:8px 12px; border-radius:6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>AI Image Generator</h1>
    <p class="note">This app runs on Vercel. The serverless function calls OpenAI’s Images API using your project’s environment variables.</p>

    <div class="env note">
      Make sure you set <strong>OPENAI_API_KEY</strong> (and optional <strong>GATE_PASSWORD</strong>) in your Vercel project settings.
    </div>

    <label for="prompt" style="margin-top:12px;"><strong>Prompt</strong></label>
    <textarea id="prompt" placeholder="e.g., A cozy living room in Scandinavian style, soft natural light, wide-angle, magazine photo"></textarea>

    <div class="row" style="margin-top:8px">
      <label>Size
        <select id="size">
          <option>512x512</option>
          <option selected>1024x1024</option>
          <option>1024x1792</option>
          <option>1792x1024</option>
        </select>
      </label>

      <label>Password
        <input id="pwd" type="password" placeholder="only if required" />
      </label>

      <button id="go">Generate</button>
    </div>

    <div id="status" class="note" style="margin-top:10px"></div>

    <div id="out" class="preview" style="display:none">
      <img id="img" alt="Result" />
      <a id="download" download="ai_image.png">Download PNG</a>
    </div>
  </div>

  <script>
    const go = document.getElementById("go");
    const statusEl = document.getElementById("status");
    const out = document.getElementById("out");
    const img = document.getElementById("img");
    const dl = document.getElementById("download");

    go.addEventListener("click", async () => {
      const prompt = document.getElementById("prompt").value.trim();
      const size = document.getElementById("size").value;
      const password = document.getElementById("pwd").value;

      if (!prompt) {
        statusEl.textContent = "Please enter a prompt.";
        return;
      }
      go.disabled = true;
      statusEl.textContent = "Generating…";

      try {
        const r = await fetch("/api/generate-image", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt, size, password })
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || "Request failed");

        img.src = data.dataUrl;
        dl.href = data.dataUrl;
        out.style.display = "block";
        statusEl.textContent = "Done.";
      } catch (e) {
        statusEl.textContent = "Error: " + e.message;
      } finally {
        go.disabled = false;
      }
    });
  </script>
</body>
</html>
